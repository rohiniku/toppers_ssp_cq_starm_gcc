----------------------------------------------------------------------
     TOPPERS/SSP Kernel
         Smallest Set Profile Kernel
 
     Copyright (C) 2011-2012 by Meika Sugimoto
 
 上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
 ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
     権表示，この利用条件および下記の無保証規定が，そのままの形でソー
     スコード中に含まれていること．
 (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
     用できる形で再配布する場合には，再配布に伴うドキュメント（利用
     者マニュアルなど）に，上記の著作権表示，この利用条件および下記
     の無保証規定を掲載すること．
 (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
     用できない形で再配布する場合には，次のいずれかの条件を満たすこ
     と．
   (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
       作権表示，この利用条件および下記の無保証規定を掲載すること．
   (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
       報告すること．
 (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
     害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
     また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
     由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
     免責すること．
 
 本ソフトウェアは，無保証で提供されているものである．上記著作権者お
 よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
 に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
 アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
 の責任を負わない．
 
----------------------------------------------------------------------


　本ドキュメントでは，TOPPERS統合仕様書に記述されていない，TOPPERS/SSPカーネルの
静的APIについて記述する．将来的にはTOPPERS統合仕様書に統合される予定であるため
次回以降のリリースでは本ドキュメントは削除される予定である．

----------------------------------------------------------------------
DEF_EPRI	タスクの実行時優先度の定義〔S〕

【静的API】
	DEF_EPRI(ID tskid, { PRI exepri })

【パラメータ】
	ID			tskid		対象タスクのID番号
	PRI			exepri		タスクの実行時優先度

【エラーコード】
	E_ID			不正ID番号（tskidが不正）
	E_PAR			パラメータエラー（exepriが不正）
	E_ILUSE			サービスコール不正使用（exepriが，自タスクの起動時
					優先度よりも低い場合）
	E_OBJ			オブジェクト状態エラー（対象タスクに対して実行優先
					度が設定済み）

【サポートするカーネル】

DEF_EPRIは，TOPPERS/SSPカーネルのみがサポートする静的APIである．他のカー
ネルは，DEF_EPRIをサポートしない．

【機能】

tskidで指定したタスク（対象タスク）の実行時優先度を，exepriで指定した優
先度に設定する．

tskidはオブジェクト識別名，exepriは整数定数式パラメータである．

exepriは，TMIN_TPRI以上，TMAX_TPRI以下でなければならない．また，exepri
は，対象タスクの起動時優先度と同じかそれよりも高くなければならない．

【μITRON4.0仕様との関係】

μITRON4.0仕様に定義されていない静的APIである．

【特記事項】

SSPカーネルの次期以降のバージョンにおいてはAPI名称をDEF_EPRに変更する予定である．
TOPPERS統合仕様書での記載も記述もDEF_EPRとなる．

----------------------------------------------------------------------
DEF_ICS		非タスクコンテキスト用スタック領域の設定〔S〕

【静的API】
	DEF_ICS({ SIZE istksz, STK_T *istk })

【パラメータ】
　＊非タスクコンテキスト用スタック領域の設定情報
	SIZE		istksz		非タスクコンテキスト用スタック領域のサイズ
							（バイト数）
	STK_T		istk		非タスクコンテキスト用スタック領域の先頭番地

【エラーコード】
	E_RSATR			予約属性（属する保護ドメインかクラスが不正）
	E_PAR			パラメータエラー（istksz，istkが不正）
	E_NOMEM			メモリ不足（非タスクコンテキスト用スタック領域が確
					保できない）
	E_OBJ			オブジェクト状態エラー（非タスクコンテキスト用スタッ
					ク領域がすでに設定されている，その他の条件について
					は機能の項を参照すること）

【機能】

各パラメータで指定した非タスクコンテキスト用スタック領域の設定情報に従っ
て，非タスクコンテキスト用スタック領域を設定する．

istkszは整数定数式パラメータ，istkは一般定数式パラメータである．コンフィ
ギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができ
ない．

istkをNULLとした場合，istkszで指定したサイズのスタック領域を，コンフィ
ギュレータが確保する．istkszにターゲット定義の制約に合致しないサイズを
指定した時には，ターゲット定義の制約に合致するようにサイズを大きい方に
丸めて確保する．

スタック領域をアプリケーションで確保する場合には，istkszで指定したサイ
ズのスタック領域を確保し，istkにその先頭番地を指定する．スタック領域を
アプリケーションで確保するために用意しているデータ型とマクロについては，
CRE_TSKの機能の項を参照すること．

保護機能対応カーネルでは，istkとistkszで指定した非タスクコンテキスト用
のスタック領域がカーネル専用のメモリオブジェクトに含まれない場合，
E_OBJエラーとなる．

DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合，ターゲッ
ト定義のデフォルトのサイズのスタック領域を，コンフィギュレータが確保す
る．

マルチプロセッサ対応カーネルでは，非タスクコンテキスト用スタック領域は
プロセッサ毎に確保する必要がある．DEF_ICSにより設定する非タスクコンテキ
スト用スタック領域は，DEF_ICSの記述をその囲みの中に含むクラスの初期割付
けプロセッサが使用する．そのプロセッサに対してすでに非タスクコンテキス
ト用スタック領域が設定されている場合には，E_OBJエラーとなる．

保護機能対応カーネルにおいて，DEF_ICSは，カーネルドメインの囲みの中に記
述しなければならない．そうでない場合には，E_RSATRエラーとなる．

istkやistkszにターゲット定義の制約に合致しない先頭番地やサイズを指定し
た時には，E_PARエラーとなる．

【TOPPERS/SSPカーネルにおける規定】

SSPカーネルでは，すべての処理単位が同一のスタック領域（これを，共有スタッ
ク領域と呼ぶ）を使用し，DEF_ICSは共有スタック領域を設定する機能となる．
istkszに指定したスタック領域のサイズが，生成したタスクの中で最大のスタッ
ク領域のサイズよりも小さい場合，コンフィギュレータが警告メッセージを出
力する．

【μITRON4.0仕様との関係】

μITRON4.0仕様に定義されていない静的APIである．

【特記事項】

SSPカーネルの次期以降のバージョンにおいては共有スタック領域の確保を行う
API名称をDEF_STKに変更する予定である．DEF_TSKの導入に伴いDEF_ICSは非タスク
コンテキスト用スタック領域用のAPIに戻るため，留意が必要である．


以上
